# 多Agent协同对话技能

你现在可以使用 `multi_agent_chat` MCP 工具来处理复杂的、涉及多个领域的问题。

## 🎯 何时使用这个技能

当用户的问题**同时涉及多个领域**时，使用此技能。例如：

✅ **适合使用的场景**：
- "公司的经营情况怎么样？公司有多少人？研发的进度怎么样？"（涉及财务+人力+研发）
- "我们的预算够支付研发团队的薪资吗？"（涉及财务+人力）
- "项目延期会影响财务目标吗？"（涉及研发+财务）

❌ **不需要使用的场景**：
- "公司有多少人？"（单一领域，直接回答即可）
- "今天天气怎么样？"（与业务无关）

## 📋 可用的 Agent

系统目前支持以下专业 Agent：

1. **财务 Agent**：处理财务、经营、成本、预算、报销等问题
2. **人力 Agent**：处理人员、招聘、考勤、薪资、绩效等问题
3. **研发 Agent**：处理项目进度、技术方案、代码、bug 等问题

## 🔧 使用方法

### 步骤1：判断是否需要使用

检查用户问题是否涉及多个领域。

### 步骤2：调用 MCP 工具

使用 `multi_agent_chat` 工具，传入以下参数：

```json
{
  "question": "用户的完整问题",
  "app_key": "ADP AppKey"
}
```

**关于 app_key**：
- 如果用户在问题中提供了 AppKey，使用用户提供的
- 如果用户没有提供，**询问用户获取 AppKey**
- 不要使用虚假或默认的 AppKey

### 步骤3：处理返回结果

工具会返回整合后的答案，包含：
- 完整的答复（已经整合了多个 Agent 的回答）
- 处理详情（显示调用了哪些 Agent）

你只需要将结果展示给用户即可。

## 💡 示例对话

### 示例1：完整流程

**用户**："公司的经营情况怎么样？公司有多少人？研发的进度怎么样？"

**你的思考**：
1. 这个问题涉及三个领域：财务、人力、研发
2. 适合使用 multi_agent_chat 工具
3. 但用户没有提供 AppKey

**你的回复**：
"我注意到您的问题涉及财务、人力和研发三个领域。为了给您提供准确的信息，我需要调用多个专业 Agent。

请提供您的 ADP AppKey，我将为您查询这些信息。"

**用户**："我的 AppKey 是 xxx"

**你的操作**：
调用 MCP 工具：
```json
{
  "question": "公司的经营情况怎么样？公司有多少人？研发的进度怎么样？",
  "app_key": "xxx"
}
```

**你的回复**：
[展示工具返回的整合结果]

### 示例2：单一领域问题

**用户**："公司有多少人？"

**你的思考**：
1. 这只涉及人力领域
2. 不需要使用 multi_agent_chat
3. 可以直接使用单个 Agent 或其他方式回答

**你的回复**：
[直接回答或使用其他工具]

## ⚠️ 注意事项

1. **AppKey 安全**
   - 不要在日志中打印完整的 AppKey
   - 不要存储用户的 AppKey

2. **错误处理**
   - 如果某个 Agent 调用失败，工具会标注失败信息
   - 你需要向用户说明哪部分信息暂时无法获取

3. **响应时间**
   - 由于需要调用多个 Agent，响应可能需要几秒到几十秒
   - 可以提前告知用户"正在查询中，请稍候"

4. **结果展示**
   - 工具返回的结果已经整合好了，直接展示即可
   - 不需要再次加工或总结

## 🔍 工作原理

当你调用 `multi_agent_chat` 后，系统会：

1. **意图识别**：分析问题涉及哪些领域
2. **问题拆解**：将复杂问题拆解为多个子问题
3. **并行调用**：同时调用相关的 Agent（节省时间）
4. **结果整合**：将多个答案整合成连贯的回复

整个过程对用户透明，用户只会看到最终的整合结果。

## 📊 性能优化

- **并行调用**：多个 Agent 同时执行，不是串行
- **智能路由**：只调用相关的 Agent，不会调用所有 Agent
- **超时控制**：单个 Agent 超时不影响其他 Agent

## 🎓 最佳实践

1. **明确告知用户**：在调用前告知用户你将查询哪些方面的信息
2. **处理失败情况**：如果部分 Agent 失败，明确告知用户哪些信息暂时无法获取
3. **保持简洁**：不要重复工具已经整合好的内容
4. **追问细节**：如果用户对某个领域的答案不满意，可以针对性追问

## 🚀 开始使用

现在你已经了解了如何使用 `multi_agent_chat` 工具。

记住：
- ✅ 多领域问题 → 使用此工具
- ❌ 单一领域问题 → 使用其他方式
- 🔑 始终需要用户提供 AppKey
- 📝 直接展示整合后的结果

祝你使用愉快！🎉
